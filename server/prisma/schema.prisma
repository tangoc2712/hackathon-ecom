generator client {
  provider = "prisma-client-js"
  previewFeatures = ["multiSchema", "postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public"]
  extensions = [vector]
}

model User {
  user_id       String    @id @default(uuid())
  email         String    @unique
  password_hash String?
  full_name     String?
  phone         String?
  address       String?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)
  is_active     Boolean?
  img_url       String?   @db.VarChar(255)
  role_id       Int?
  date_of_birth DateTime? @db.Date
  job           String?
  gender        String?
  uid           String?   @unique
  photo_url     String?
  provider      String?
  role          String?   @default("user")
  city          String?
  country       String?
  embedding     Unsupported("vector")?

  orders        Order[]
  reviews       ProductReview[]

  @@map("user")
  @@schema("public")
}

model Product {
  product_id      String    @id @default(uuid()) @db.Uuid
  sku             String?   @unique
  name            String?
  description     String?
  price           Decimal?  @db.Decimal
  currency        String?   @db.Char(1)
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)
  is_active       Boolean?
  sale_price      Decimal?  @db.Decimal
  category_id     Int?
  product_url     String?   @db.VarChar(255)
  stock           Int?      @default(0)
  photos          String[]
  colors          Json?     @default("[]")
  sizes           String[]
  materials       String?
  care            String?
  photo_public_id String?
  featured        Boolean?  @default(false)
  category_name   String?
  embedding       Unsupported("vector")?

  orderItems      OrderItem[]
  reviews         ProductReview[]

  @@map("product")
  @@schema("public")
}

model Category {
  category_id         Int @id
  name                String?
  parent_category_id  Int?
  type                String?
  img_url             String?
  created_at          DateTime? @default(now()) @db.Timestamptz(6)
  updated_at          DateTime? @default(now()) @db.Timestamptz(6)

  @@map("category")
  @@schema("public")
}

model Order {
  order_id         String    @id @default(uuid()) @db.Uuid
  user_id          String?
  status           String?
  order_total      Decimal?  @db.Decimal(12, 2)
  currency         String?   @default("USD") @db.Char(3)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)
  shipping_info    Json?
  subtotal         Decimal?  @default(0) @db.Decimal
  tax              Decimal?  @default(0) @db.Decimal
  shipping_charges Decimal?  @default(0) @db.Decimal
  discount         Decimal?  @default(0) @db.Decimal

  embedding        Unsupported("vector")?

  user             User?     @relation(fields: [user_id], references: [user_id])
  
  orderItems       OrderItem[]

  @@map("order")
  @@schema("public")
}

model OrderItem {
  order_item_id String  @id @default(uuid()) @db.Uuid
  order_id      String? @db.Uuid
  product_id    String? @db.Uuid
  quantity      Int?
  unit_price    Decimal? @db.Decimal(12, 2)
  total_price   Decimal? @db.Decimal(12, 2)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  embedding     Unsupported("vector")?

  order         Order?   @relation(fields: [order_id], references: [order_id])
  product       Product? @relation(fields: [product_id], references: [product_id])

  @@map("order_item")
  @@schema("public")
}

model Coupon {
  id            String    @id @default(uuid()) @db.Uuid @map("coupon_id")
  code          String    @unique
  amount        Decimal?
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  discount_type String?
  usage_count   Int?
  valid_from    DateTime? @db.Timestamp(6)
  valid_to      DateTime? @db.Timestamp(6)
  value         Decimal?
  embedding     Unsupported("vector")?

  @@map("coupon")
  @@schema("public")
}

model ProductReview {
  product_review_id String    @id @default(uuid()) @db.Uuid
  product_id        String?   @db.Uuid
  user_id           String?
  rating            Int?
  title             String?
  comment           String?
  created_at        DateTime? @default(now()) @db.Timestamptz(6)
  updated_at        DateTime? @default(now()) @db.Timestamptz(6)
  embedding         Unsupported("vector")?

  product Product? @relation(fields: [product_id], references: [product_id], onDelete: Cascade)
  user    User?    @relation(fields: [user_id], references: [user_id])

  @@map("product_review")
  @@schema("public")
}
